<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 4: Proportions & Percentages - Math Tutor</title>
    <link rel="stylesheet" href="design-system.css">
</head>
<body class="bg-lightest-neutral">

<header class="header-dark">
    <div class="max-w-6xl mx-auto px-4 py-6">
        <div class="flex items-center justify-between">
            <h1 class="text-2xl font-bold text-white flex items-center gap-2">
                <i data-lucide="percent" class="w-8 h-8"></i>
                Chapter 4: Proportions & Percentages
            </h1>
            <nav>
                <a href="index.html" class="text-light-neutral hover:text-white transition-colors">← Back to Chapters</a>
            </nav>
        </div>
    </div>
</header>

<main class="max-w-6xl mx-auto px-4 py-8">

    <!-- Navigation -->
    <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
        <nav class="flex flex-wrap gap-4 text-sm">
            <a href="#overview" class="btn-secondary">Chapter Overview</a>
            <a href="#tutorials" class="btn-secondary">Step-by-Step Tutorials</a>
            <a href="#formulas" class="btn-secondary">Formula Sheet</a>
            <a href="#practice" class="btn-secondary">Practice Problems</a>
            <a href="#ai-help" class="btn-secondary">Ask AI Tutor</a>
            <a href="#study-tips" class="btn-secondary">ADHD Study Tips</a>
        </nav>
    </div>

    <!-- Chapter Overview -->
    <div id="overview" class="bg-white rounded-lg shadow-sm p-6 mb-8">
        <div class="card-title-dark math mb-4">
            <span class="text-white font-semibold">Chapter Overview</span>
        </div>
        <div class="space-y-4">
            <p>Real-world ratios, cross multiplication, and percentage calculations</p>
            <div class="grid md:grid-cols-2 gap-4">
                <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4">
                    <h4 class="font-semibold text-gray-800 mb-2">What You'll Learn</h4>
                    <div id="learning-objectives">
                        <ul class="text-sm space-y-1">
                            <li>• Set up and solve proportions using cross-multiplication</li>
                            <li>• Calculate percentage increases, decreases, and find original amounts</li>
                            <li>• Work with rates, unit rates, and rates of change</li>
                            <li>• Use dimensional analysis for unit conversions</li>
                        </ul>
                    </div>
                </div>
                <div class="bg-blue-50 border-l-4 border-blue-500 p-4">
                    <h4 class="font-semibold text-gray-800 mb-2">Real-World Applications</h4>
                    <div id="applications">
                        <ul class="text-sm space-y-1">
                            <li>• Shopping and comparing prices per unit</li>
                            <li>• Calculating tips, taxes, and discounts</li>
                            <li>• Recipe scaling and cooking conversions</li>
                            <li>• Understanding interest rates and loans</li>
                            <li>• Converting between measurement systems</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tutorials Section -->
    <div id="tutorials" class="bg-white rounded-lg shadow-sm p-6 mb-8">
        <div class="card-title-dark math mb-4">
            <span class="text-white font-semibold flex items-center gap-2">
                <i data-lucide="play-circle" class="w-5 h-5"></i>
                Step-by-Step Tutorials
            </span>
        </div>
        <div id="tutorial-content" class="space-y-8">
            
            <!-- Tutorial 1: Proportions and Cross Multiplication -->
            <div class="border-l-4 border-blue-500 pl-4">
                <h4 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                    <i data-lucide="equal" class="w-5 h-5 text-blue-500"></i>
                    1. Proportions and Cross Multiplication
                </h4>
                
                <div class="grid md:grid-cols-2 gap-6 mb-4">
                    <div class="bg-green-50 p-4 rounded">
                        <h5 class="font-semibold text-green-800 mb-2">What is a Proportion?</h5>
                        <p class="text-sm text-green-700 mb-3">A proportion states that two ratios are equal: a/b = c/d</p>
                        <div class="bg-white p-3 rounded border border-green-200">
                            <p class="text-sm"><strong>Example:</strong></p>
                            <p class="text-sm mt-1">3/4 = 6/8 (both equal 0.75)</p>
                            <p class="text-sm">2/5 = 8/20 (both equal 0.4)</p>
                        </div>
                    </div>
                    
                    <div class="bg-orange-50 p-4 rounded">
                        <h5 class="font-semibold text-orange-800 mb-2">Cross Multiplication Method</h5>
                        <p class="text-sm text-orange-700 mb-3">If a/b = c/d, then a × d = b × c</p>
                        <div class="bg-white p-3 rounded border border-orange-200">
                            <p class="text-sm"><strong>Memory Tip:</strong></p>
                            <p class="text-sm mt-1">Draw an "X" and multiply across!</p>
                            <p class="text-sm font-mono">a/b = c/d → a×d = b×c</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gray-50 p-4 rounded">
                    <h5 class="font-semibold text-gray-800 mb-3">Step-by-Step Example: Solving for Unknown</h5>
                    <p class="text-sm mb-3"><strong>Problem:</strong> If 3 apples cost $2, how much do 12 apples cost?</p>
                    
                    <div class="grid md:grid-cols-4 gap-4">
                        <div class="bg-red-50 p-3 rounded border-l-4 border-red-400">
                            <h6 class="font-semibold text-red-800 text-sm">Step 1: Set Up</h6>
                            <p class="text-xs text-red-700 mt-1">3 apples / $2 = 12 apples / $x</p>
                        </div>
                        
                        <div class="bg-blue-50 p-3 rounded border-l-4 border-blue-400">
                            <h6 class="font-semibold text-blue-800 text-sm">Step 2: Cross Multiply</h6>
                            <p class="text-xs text-blue-700 mt-1">3 × x = 2 × 12</p>
                        </div>
                        
                        <div class="bg-green-50 p-3 rounded border-l-4 border-green-400">
                            <h6 class="font-semibold text-green-800 text-sm">Step 3: Solve</h6>
                            <p class="text-xs text-green-700 mt-1">3x = 24<br>x = 8</p>
                        </div>
                        
                        <div class="bg-yellow-50 p-3 rounded border-l-4 border-yellow-400">
                            <h6 class="font-semibold text-yellow-800 text-sm">Step 4: Check</h6>
                            <p class="text-xs text-yellow-700 mt-1">12 apples cost $8<br>Makes sense!</p>
                        </div>
                    </div>
                </div>
                
                <details class="bg-gray-50 p-4 rounded mt-4">
                    <summary class="font-semibold cursor-pointer">Practice: Proportion Problems</summary>
                    <div class="mt-3 space-y-3 text-sm">
                        <div class="p-3 bg-white rounded border">
                            <p><strong>1.</strong> If 5 pencils cost $3, how much do 8 pencils cost?</p>
                            <details class="mt-2">
                                <summary class="text-blue-600 cursor-pointer">Show Solution</summary>
                                <p class="mt-1">Set up: 5/$3 = 8/$x</p>
                                <p>Cross multiply: 5x = 3 × 8 = 24</p>
                                <p class="text-green-600"><strong>Answer: x = $4.80</strong></p>
                            </details>
                        </div>
                        
                        <div class="p-3 bg-white rounded border">
                            <p><strong>2.</strong> A recipe calls for 2 cups of flour for 3 servings. How much flour for 10 servings?</p>
                            <details class="mt-2">
                                <summary class="text-blue-600 cursor-pointer">Show Solution</summary>
                                <p class="mt-1">Set up: 2 cups/3 servings = x cups/10 servings</p>
                                <p>Cross multiply: 2 × 10 = 3 × x → 20 = 3x</p>
                                <p class="text-green-600"><strong>Answer: x = 6⅔ cups</strong></p>
                            </details>
                        </div>
                    </div>
                </details>
            </div>

            <!-- Tutorial 2: Percentages -->
            <div class="border-l-4 border-yellow-500 pl-4">
                <h4 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                    <i data-lucide="percent" class="w-5 h-5 text-yellow-500"></i>
                    2. Working with Percentages
                </h4>
                
                <div class="space-y-4">
                    <div class="bg-blue-50 p-4 rounded">
                        <h5 class="font-semibold text-blue-800 mb-2">Basic Percentage Formula</h5>
                        <div class="bg-white p-3 rounded border border-blue-200">
                            <p class="text-sm mb-2"><strong>Percentage of a Number:</strong> P% × N = (P/100) × N</p>
                            <p class="text-sm"><strong>Example:</strong> 25% of 80 = 0.25 × 80 = 20</p>
                        </div>
                    </div>
                    
                    <div class="bg-green-50 p-4 rounded">
                        <h5 class="font-semibold text-green-800 mb-2">Percentage Increases and Decreases</h5>
                        <div class="bg-white p-3 rounded border border-green-200 space-y-2">
                            <div>
                                <p class="text-sm font-semibold">Increase:</p>
                                <p class="text-sm">New Amount = Original × (1 + rate)</p>
                                <p class="text-sm text-green-600"><strong>Example:</strong> $100 with 15% increase = $100 × (1 + 0.15) = $115</p>
                            </div>
                            <hr>
                            <div>
                                <p class="text-sm font-semibold">Decrease:</p>
                                <p class="text-sm">New Amount = Original × (1 - rate)</p>
                                <p class="text-sm text-green-600"><strong>Example:</strong> $100 with 20% discount = $100 × (1 - 0.20) = $80</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-purple-50 p-4 rounded">
                        <h5 class="font-semibold text-purple-800 mb-2">Finding the Original Amount</h5>
                        <div class="bg-white p-3 rounded border border-purple-200">
                            <p class="text-sm mb-2"><strong>Formula:</strong> Original = New Amount ÷ (1 ± rate)</p>
                            <p class="text-sm"><strong>Example:</strong> After a 25% increase, the price is $150. What was the original price?</p>
                            <p class="text-sm text-purple-600">Original = $150 ÷ (1 + 0.25) = $150 ÷ 1.25 = $120</p>
                        </div>
                    </div>
                </div>
                
                <details class="bg-gray-50 p-4 rounded mt-4">
                    <summary class="font-semibold cursor-pointer">Practice: Real-World Percentage Problems</summary>
                    <div class="mt-3 space-y-3 text-sm">
                        <div class="p-3 bg-white rounded border">
                            <p><strong>Restaurant Bill:</strong> Your meal costs $25 and you want to leave an 18% tip. What's the total?</p>
                            <details class="mt-2">
                                <summary class="text-blue-600 cursor-pointer">Show Solution</summary>
                                <p class="mt-1">Tip = $25 × 0.18 = $4.50</p>
                                <p class="text-green-600"><strong>Total = $25 + $4.50 = $29.50</strong></p>
                            </details>
                        </div>
                        
                        <div class="p-3 bg-white rounded border">
                            <p><strong>Sale Price:</strong> A jacket originally costs $80 but is on sale for 30% off. What do you pay?</p>
                            <details class="mt-2">
                                <summary class="text-blue-600 cursor-pointer">Show Solution</summary>
                                <p class="mt-1">Sale price = $80 × (1 - 0.30) = $80 × 0.70</p>
                                <p class="text-green-600"><strong>You pay $56</strong></p>
                            </details>
                        </div>
                    </div>
                </details>
            </div>

            <!-- Tutorial 3: Rates and Unit Rates -->
            <div class="border-l-4 border-green-500 pl-4">
                <h4 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                    <i data-lucide="trending-up" class="w-5 h-5 text-green-500"></i>
                    3. Rates, Unit Rates, and Comparisons
                </h4>
                
                <div class="space-y-4">
                    <div class="bg-blue-50 p-4 rounded">
                        <h5 class="font-semibold text-blue-800 mb-2">Understanding Rates</h5>
                        <div class="bg-white p-3 rounded border border-blue-200">
                            <p class="text-sm mb-2"><strong>Rate:</strong> A comparison of two different units</p>
                            <p class="text-sm">Examples: 60 miles/hour, $3.50/pound, 25 students/class</p>
                        </div>
                    </div>
                    
                    <div class="bg-green-50 p-4 rounded">
                        <h5 class="font-semibold text-green-800 mb-2">Unit Rates</h5>
                        <div class="bg-white p-3 rounded border border-green-200">
                            <p class="text-sm mb-2"><strong>Unit Rate:</strong> Rate with a denominator of 1</p>
                            <p class="text-sm">Formula: Unit Rate = Total Amount ÷ Total Units</p>
                            <p class="text-sm text-green-600"><strong>Example:</strong> 300 miles in 5 hours = 300÷5 = 60 mph</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gray-50 p-4 rounded">
                    <h5 class="font-semibold text-gray-800 mb-3">Comparing Options Using Unit Rates</h5>
                    <p class="text-sm mb-3"><strong>Which is a better deal?</strong></p>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="bg-white p-3 rounded border">
                            <p class="text-sm font-semibold">Store A:</p>
                            <p class="text-sm">12 oz box for $3.60</p>
                            <p class="text-sm text-blue-600">Unit rate: $3.60 ÷ 12 = $0.30 per oz</p>
                        </div>
                        <div class="bg-white p-3 rounded border">
                            <p class="text-sm font-semibold">Store B:</p>
                            <p class="text-sm">16 oz box for $4.40</p>
                            <p class="text-sm text-blue-600">Unit rate: $4.40 ÷ 16 = $0.275 per oz</p>
                        </div>
                    </div>
                    <p class="text-sm mt-3 font-semibold text-green-600">Store B is better! ($0.275 < $0.30 per oz)</p>
                </div>
            </div>

            <!-- Tutorial 4: Dimensional Analysis -->
            <div class="border-l-4 border-purple-500 pl-4">
                <h4 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                    <i data-lucide="arrow-right-left" class="w-5 h-5 text-purple-500"></i>
                    4. Dimensional Analysis (Unit Conversions)
                </h4>
                
                <div class="space-y-4">
                    <div class="bg-blue-50 p-4 rounded">
                        <h5 class="font-semibold text-blue-800 mb-2">The Key Strategy</h5>
                        <div class="bg-white p-3 rounded border border-blue-200">
                            <p class="text-sm mb-2">Set up conversions as fractions so unwanted units cancel out!</p>
                            <p class="text-sm">Always put what you want to convert TO on top</p>
                        </div>
                    </div>
                    
                    <div class="bg-yellow-50 p-4 rounded">
                        <h5 class="font-semibold text-yellow-800 mb-2">Step-by-Step Example</h5>
                        <p class="text-sm mb-3"><strong>Convert 5 hours to minutes</strong></p>
                        <div class="space-y-2 text-sm">
                            <p>Step 1: Start with what you have → 5 hours</p>
                            <p>Step 2: Set up conversion → 5 hours × (60 minutes/1 hour)</p>
                            <p>Step 3: Cancel units → 5 <span class="line-through">hours</span> × (60 minutes/1 <span class="line-through">hour</span>)</p>
                            <p class="font-semibold text-yellow-800">Answer: 5 × 60 = 300 minutes</p>
                        </div>
                    </div>
                    
                    <div class="bg-green-50 p-4 rounded">
                        <h5 class="font-semibold text-green-800 mb-2">Multi-Step Conversion</h5>
                        <p class="text-sm mb-3"><strong>Convert 2 days to seconds</strong></p>
                        <div class="text-sm bg-white p-3 rounded border border-green-200">
                            <p>2 days × (24 hours/1 day) × (60 minutes/1 hour) × (60 seconds/1 minute)</p>
                            <p>= 2 × 24 × 60 × 60 = 172,800 seconds</p>
                        </div>
                    </div>
                </div>
                
                <details class="bg-gray-50 p-4 rounded mt-4">
                    <summary class="font-semibold cursor-pointer">Practice: Conversion Challenge</summary>
                    <div class="mt-3 space-y-3 text-sm">
                        <div class="p-3 bg-white rounded border">
                            <p><strong>Speed Conversion:</strong> A car travels at 75 mph. What is this in feet per second?</p>
                            <p class="text-xs text-gray-600">Hint: 1 mile = 5,280 feet, 1 hour = 3,600 seconds</p>
                            <details class="mt-2">
                                <summary class="text-blue-600 cursor-pointer">Show Solution</summary>
                                <p class="mt-1">75 miles/hour × (5,280 feet/1 mile) × (1 hour/3,600 seconds)</p>
                                <p>= 75 × 5,280 ÷ 3,600 = 110 feet per second</p>
                            </details>
                        </div>
                    </div>
                </details>
            </div>

        </div>
    </div>

    <!-- AI Tutor Integration -->
    <div id="ai-help" class="bg-white rounded-lg shadow-sm p-6 mb-8">
        <div class="card-title-dark math mb-4">
            <span class="text-white font-semibold flex items-center gap-2">
                <i data-lucide="bot" class="w-5 h-5"></i>
                Ask Your AI Tutor
            </span>
        </div>
        <div class="space-y-4">
            <p class="text-gray-600">Stuck on something? Get personalized help right now!</p>
            <div class="border border-gray-200 rounded-lg p-4">
                <textarea 
                    id="ai-question" 
                    placeholder="Ask me anything about Chapter 4... For example: 'I don't understand how to solve proportions' or 'Can you explain this step by step?'"
                    class="w-full h-24 p-3 border border-gray-300 rounded resize-none focus:border-yellow-500 focus:outline-none"
                ></textarea>
                <div class="flex gap-3 mt-3">
                    <button onclick="askAITutor(4)" class="btn btn-primary is-math">
                        <i data-lucide="send" class="w-4 h-4 mr-2"></i>
                        Get Help Now
                    </button>
                    <button onclick="getHint(4)" class="btn btn-secondary">
                        <i data-lucide="lightbulb" class="w-4 h-4 mr-2"></i>
                        Just Give Me a Hint
                    </button>
                </div>
            </div>
            <div id="ai-response" class="hidden mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                <h5 class="font-semibold text-green-800 mb-2 flex items-center gap-2">
                    <i data-lucide="check-circle" class="w-4 h-4"></i>
                    Your AI Tutor Says:
                </h5>
                <div id="ai-answer" class="text-green-700"></div>
            </div>
        </div>
    </div>

    <!-- Formula Sheet -->
    <div id="formulas" class="bg-white rounded-lg shadow-sm p-6 mb-8">
        <div class="card-title-dark math mb-4">
            <span class="text-white font-semibold flex items-center gap-2">
                <i data-lucide="book-open" class="w-5 h-5"></i>
                Chapter 4 Formula Sheet
            </span>
        </div>
        
        <div class="grid md:grid-cols-2 gap-6">
            <div>
                <h4 class="font-semibold text-gray-800 mb-3">Proportions & Cross Multiplication</h4>
                <div class="space-y-3 text-sm">
                    <div class="bg-blue-50 p-3 rounded border-l-4 border-blue-400">
                        <strong>Proportion:</strong> a/b = c/d<br>
                        <strong>Cross Multiply:</strong> a × d = b × c
                    </div>
                    <div class="bg-green-50 p-3 rounded border-l-4 border-green-400">
                        <strong>Unit Rate:</strong><br>
                        Total Amount ÷ Total Units
                    </div>
                </div>
            </div>
            
            <div>
                <h4 class="font-semibold text-gray-800 mb-3">Percentage Formulas</h4>
                <div class="space-y-3 text-sm">
                    <div class="bg-yellow-50 p-3 rounded border-l-4 border-yellow-400">
                        <strong>Percentage of Number:</strong><br>
                        P% × N = (P/100) × N
                    </div>
                    <div class="bg-purple-50 p-3 rounded border-l-4 border-purple-400">
                        <strong>Increase/Decrease:</strong><br>
                        New = Original × (1 ± rate)
                    </div>
                    <div class="bg-orange-50 p-3 rounded border-l-4 border-orange-400">
                        <strong>Find Original:</strong><br>
                        Original = New ÷ (1 ± rate)
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ADHD Study Tips -->
    <div id="study-tips" class="bg-white rounded-lg shadow-sm p-6 mb-8">
        <div class="card-title-dark math mb-4">
            <span class="text-white font-semibold flex items-center gap-2">
                <i data-lucide="heart" class="w-5 h-5"></i>
                ADHD-Friendly Study Tips
            </span>
        </div>
        
        <div class="grid md:grid-cols-2 gap-6">
            <div class="space-y-4">
                <div class="bg-blue-50 p-4 rounded border-l-4 border-blue-500">
                    <h4 class="font-semibold text-blue-800 mb-2">Memory Tricks</h4>
                    <ul class="text-sm text-blue-700 space-y-1">
                        <li>✖️ <strong>"Cross your fingers"</strong> - Cross multiply for proportions</li>
                        <li>🎯 <strong>"Units on a diet"</strong> - Unit rates have 1 on bottom</li>
                        <li>💰 <strong>"Tip trick"</strong> - Multiply by 0.18 for 18% tip</li>
                        <li>🔄 <strong>"Fraction sandwich"</strong> - Stack conversions to cancel units</li>
                    </ul>
                </div>
                
                <div class="bg-green-50 p-4 rounded border-l-4 border-green-500">
                    <h4 class="font-semibold text-green-800 mb-2">Organization Tips</h4>
                    <ul class="text-sm text-green-700 space-y-1">
                        <li>📝 Always write out the proportion setup first</li>
                        <li>🏷️ Label your units clearly</li>
                        <li>✅ Circle what you're solving for</li>
                        <li>🎨 Use different colors for numerator/denominator</li>
                    </ul>
                </div>
            </div>
            
            <div class="space-y-4">
                <div class="bg-yellow-50 p-4 rounded border-l-4 border-yellow-500">
                    <h4 class="font-semibold text-yellow-800 mb-2">Problem-Solving Steps</h4>
                    <ol class="text-sm text-yellow-700 space-y-1 list-decimal list-inside">
                        <li>Read the problem twice</li>
                        <li>Identify what you're looking for</li>
                        <li>Set up the proportion carefully</li>
                        <li>Cross multiply and solve</li>
                        <li>Check: Does the answer make sense?</li>
                    </ol>
                </div>
                
                <div class="bg-purple-50 p-4 rounded border-l-4 border-purple-500">
                    <h4 class="font-semibold text-purple-800 mb-2">Test Day Strategy</h4>
                    <ul class="text-sm text-purple-700 space-y-1">
                        <li>🔢 Start with easier proportions to build confidence</li>
                        <li>💡 If stuck, try plugging in your answer</li>
                        <li>📊 For percentage problems, estimate first</li>
                        <li>⚡ Use unit rates to compare options quickly</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="mt-6 p-4 bg-coral-50 border border-coral-200 rounded">
            <h4 class="font-semibold text-coral-800 mb-2 flex items-center gap-2">
                <i data-lucide="star" class="w-4 h-4"></i>
                Chapter 4 Success Mantra
            </h4>
            <p class="text-sm text-coral-700">"Proportions are just equal ratios, percentages are parts of 100, and rates help me compare. I can set these up step by step and cross multiply my way to success!" 💪</p>
        </div>
    </div>

    <!-- Progress Tracking -->
    <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
        <div class="card-title-dark math mb-4">
            <span class="text-white font-semibold flex items-center gap-2">
                <i data-lucide="target" class="w-5 h-5"></i>
                Your Progress
            </span>
        </div>
        <div class="space-y-4">
            <div class="flex items-center justify-between">
                <span>Chapter 4 Completion</span>
                <div class="flex items-center gap-2">
                    <div class="w-32 h-2 bg-gray-200 rounded-full">
                        <div id="progress-bar-4" class="h-2 bg-yellow-500 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <span id="progress-text-4" class="text-sm text-gray-600">0%</span>
                </div>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3" id="progress-checklist-4">
                <!-- Progress items will be added dynamically -->
            </div>
        </div>
    </div>

</main>

<script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
<script>
    // Initialize chapter content
    document.addEventListener('DOMContentLoaded', function() {
        loadChapterContent(4);
        loadProgress(4);
        lucide.createIcons();
    });
    
    // AI Tutor Functions
    async function askAITutor(chapter) {
        const question = document.getElementById('ai-question').value;
        if (!question.trim()) return;
        
        const responseDiv = document.getElementById('ai-response');
        const answerDiv = document.getElementById('ai-answer');
        
        responseDiv.classList.remove('hidden');
        answerDiv.innerHTML = '<i data-lucide="loader-2" class="w-4 h-4 animate-spin inline mr-2"></i>Thinking...';
        
        try {
            const response = await fetch('/api/ai-tutor', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    question: question,
                    chapter: chapter,
                    context: 'math-tutorial'
                })
            });
            
            const data = await response.json();
            answerDiv.innerHTML = data.answer;
            lucide.createIcons();
            
            // Track engagement
            updateProgress(chapter, 'ai-help-used');
        } catch (error) {
            answerDiv.innerHTML = 'Sorry, I had trouble connecting. Please try again in a moment.';
        }
    }
    
    // Progress tracking
    function updateProgress(chapter, action) {
        const progress = getProgress(chapter);
        progress[action] = true;
        saveProgress(chapter, progress);
        updateProgressDisplay(chapter);
    }
</script>

</body>
</html>